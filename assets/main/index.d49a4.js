System.register("chunks:///main.js",["./event-bus-3e1eb33c.js","./rollupPluginModLoBabelHelpers-ec5e44d8.js","cc"],(function(){var t,e,n,i,r,a,s,o,u,c,h,l,p,d,f,g,v,_,m,y,b,x,w,E,R,I,F,C,T,k,M,S,P,D,A;return{setters:[function(i){t=i.E,e=i.a,n=i.I},function(t){i=t.d,r=t.a,a=t.f,s=t.g,o=t._,u=t.b,c=t.c},function(t){h=t.cclegacy,l=t.macro,p=t.Vec2,d=t.EPSILON,f=t.v2,g=t.assetManager,v=t.director,_=t.Canvas,m=t.instantiate,y=t._decorator,b=t.CCBoolean,x=t.Mat4,w=t.Rect,E=t.color,R=t.Sprite,I=t.UITransform,F=t.v3,C=t.Camera,T=t.Prefab,k=t.Node,M=t.view,S=t.Component,P=t.Graphics,D=t.Color,A=t.Slider}],execute:function(){h._RF.push({},"bafdbJWtlRMtIBA8rggrYOs","audio-manager",void 0);var N,L=function(){function t(){}var e=t.prototype;return e.play=function(){},e.mute=function(){},t}();h._RF.pop(),h._RF.push({},"2d474MA9zlKT7KYhPXWujVv","timer",void 0),h._RF.pop(),h._RF.push({},"cbb52/4iVtIkojpERPtmU9A","cpu-homie",void 0);var V=function(t){return t[t.WAITING=0]="WAITING",t[t.PENDING=1]="PENDING",t[t.SETTLED=2]="SETTLED",t[t.CANCELED=3]="CANCELED",t}({}),z=function(){function t(t,e){var n=this;this._startTime=void 0,this._state=V.WAITING,this._handle=void 0,this._resolve=void 0,this._iterator=void 0,this._frameTime=void 0,this._frameStart=void 0,this._iterator=t,this._frameTime=e,this._handle=new Promise((function(t){n._resolve=t}))}var e=t.prototype;return e.autoRun=function(t){var e=this;return N.schedule((function n(){e._iterator&&!e.done||N.unschedule(n),e.tick(null==t?void 0:t())}),0,l.REPEAT_FOREVER),this.handle},e.tick=function(t){if(!this.done){this._state===V.WAITING&&(this._startTime=performance.now(),this._state=V.PENDING),this._frameStart=performance.now();do{var e;if(null!=(e=this._iterator)&&null!=(e=e.next(t))&&e.done)return this.clear(V.SETTLED)}while(performance.now()-this._frameStart<this._frameTime)}},e.clear=function(t){return void 0===t&&(t=V.CANCELED),this._state=t,delete this._iterator,this._resolve(this.done)},i(t,[{key:"done",get:function(){return this._state===V.SETTLED}},{key:"startTime",get:function(){return this._startTime}},{key:"state",get:function(){return this._state}},{key:"pending",get:function(){return this._state===V.PENDING}},{key:"handle",get:function(){return this._handle}}]),t}();function O(t,e){void 0===e&&(e=Math.random);for(var n=t.length,i=0;i<n;i++){var r=Math.floor(e()*(n-i))+i,a=[t[r],t[i]];t[i]=a[0],t[r]=a[1]}}h._RF.pop(),h._RF.push({},"3d9f8T1Jg1Nar70sIcIg5kK","fisher-yates-shuffle",void 0),h._RF.pop(),h._RF.push({},"fd19ckEbDlKVI/6qZKvAmoj","hash",void 0);var q=function(){function t(){}return t.Line=function(e,n){return""+[e,n].sort((function(t,e){return t.x!==e.x?t.x-e.x:t.y-e.y})).map((function(e){return t.Point(e)})).join("-")},t.Point=function(t,e){return t instanceof p?"p"+t.x+","+t.y:"p"+t+","+e},t}();h._RF.pop(),h._RF.push({},"73790qptkdLKZw2UK4LCUGl","macros",void 0);var U=720;h._RF.pop(),h._RF.push({},"f797923NORDO75olCw52+BD","object-pool",void 0);var H=function(){function t(){}return t._getItemArray=function(e){var n;return t._itemArrayMap.has(e)?n=t._itemArrayMap.get(e):(n=[],t._itemArrayMap.set(e,n)),n},t.init=function(){t._initMap.forEach((function(e,n){for(var i=t._getItemArray(n),r=0;r<e;r++)i.push(new n)})),t._initMap.clear()},t.allocate=function(e){var n,i,r=t._getItemArray(e);i=r.length?r.pop():new e;for(var a=arguments.length,s=new Array(a>1?a-1:0),o=1;o<a;o++)s[o-1]=arguments[o];return null==i.initialize||(n=i).initialize.apply(n,s),i},t.clear=function(e){t._initMap.clear(),t._getItemArray(e).forEach((function(t){return null==t.release?void 0:t.release()})),t._getItemArray(e).length=0},t.register=function(e,n){return void 0===e&&(e=128),void 0===n&&(n=0),function(i){var a=function(n){function i(){return n.apply(this,arguments)||this}return r(i,n),i.prototype.release=function(){for(var r,a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];null==(r=n.prototype.release)||r.call.apply(r,[this].concat(s));var u=t._getItemArray(i);u.length<e&&t._getItemArray(i).push(this)},i}(i);return n>0&&t._initMap.set(a,n),a}},t}();function G(t){return Math.round(t/d)*d}H._itemArrayMap=new WeakMap,H._initMap=new Map,h._RF.pop(),h._RF.push({},"f42951+6RNNprYvYUl4RWkd","precision",void 0),h._RF.pop(),h._RF.push({},"03112hXRQVDSY64N4CA/O5i","convex-polygon",void 0);var B,Y=function(){function t(){this.center=f(),this._edgeHashs=void 0,this.edge1=f(),this.edge2=f(),this._clone=f()}var e=t.prototype;return e.initialize=function(t){if(t.length!==this.points.length)throw new Error("invalid length");this.points.forEach((function(e,n){return e.set(G(t[n].x),G(t[n].y))})),this.resetCenter(),this._sortPoints()},e.release=function(){},e.contains=function(t){var e=this;return this.points.length===Math.abs(this.points.reduce((function(n,i,r,a){return e.edge1.set(i).subtract(a[(a.length+r+1)%a.length]),e.edge2.set(t.x,t.y).subtract(i),n+(e.edge2.cross(e.edge1)>0?1:-1)}),0))},e.equals=function(t){var e=this;return t.points.length===this.points.length&&t.points.every((function(t,n){return t.equals(e.points[n])}))},e.resetCenter=function(){this.center.set(G(this.points.reduce((function(t,e){return t+e.x}),0)/this.points.length),G(this.points.reduce((function(t,e){return t+e.y}),0)/this.points.length))},e.calcEdgeHash=function(){this._edgeHashs=this.points.map((function(t,e,n){return q.Line(t,n[(e+1)%n.length])}))},e._theta=function(t){var e=p.UNIT_X.signAngle(p.subtract(this._clone,t,this.center));return e>=0?e:e+2*Math.PI},e._sortPoints=function(){var t=this;this.points.sort((function(e,n){return t._theta(e)-t._theta(n)}))},i(t,[{key:"edgeHashs",get:function(){return this._edgeHashs}}]),t}();h._RF.pop(),h._RF.push({},"c7dbffxLNtOCKKeE0+fEK9N","hexagons",void 0);var W,K=H.register()(B=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).points=[f(),f(),f(),f(),f(),f()],e}return r(e,t),e}(Y))||B;h._RF.pop(),h._RF.push({},"248feimI75KQqQkt7c6+fv2","quad",void 0);var Q,j=H.register()(W=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).points=[f(),f(),f(),f()],e}return r(e,t),e}(Y))||W;h._RF.pop(),h._RF.push({},"9ac074DuTtG/rsy8pCgf8Cu","triangle",void 0);var J,X=H.register()(Q=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).points=[f(),f(),f()],e}return r(e,t),e}(Y))||Q;h._RF.pop(),h._RF.push({},"ad639UdEDVDrKnT4rwPL8ik","mesh-grid",void 0);var Z=H.register(1,1)(J=function(){function t(){this.size=void 0,this.groups=[],this.quads=[],this._hexagons=[],this._triangles=[],this._polygons=[],this._process=void 0}var e=t.prototype;return e.generate=function(){var t=this;return this._process=new z(this._calculate(),12),this._process.autoRun((function(){return t._process.pending&&performance.now()-t._process.startTime>3e3}))},e.initialize=function(t){this.size=t/.45},e.release=function(){var t;null==(t=this._process)||t.clear(),this.quads.forEach((function(t){return t.release()})),this.quads.length=0,this.groups.length=0},e._calculate=a().mark((function t(){var e,n,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=~~(U/this.size),n=~~(720/this.size),t.delegateYield(this._generateHexagons(e,n,this.size),"t0",3);case 3:return t.delegateYield(this._divideHexagonsIntoTriangles(),"t1",4);case 4:return t.delegateYield(this._randomlyMergeTriangles(),"t2",5);case 5:return t.delegateYield(this._subdivideIntoQuads(),"t3",6);case 6:i=0;case 7:if(!(i<12)){t.next=12;break}return t.delegateYield(this._smoothQuads(),"t4",9);case 9:i++,t.next=7;break;case 12:return t.delegateYield(this._filterQuads(U,720),"t5",13);case 13:return t.delegateYield(this._groupingQuads(),"t6",14);case 14:case"end":return t.stop()}}),t,this)})),e._generateHexagons=a().mark((function t(e,n,i){var r,s,o,u;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(r=f(),s=[f(),f(),f(),f(),f(),f()],o=0;o<e;o++)for(u=0;u<n;u++)r.set((2*o+u%2)*Math.cos(Math.PI/6),u*(1+Math.sin(Math.PI/6))),s.forEach((function(t,e){t.set(r.x+Math.cos((1+2*e)*Math.PI/6),r.y+Math.sin((1+2*e)*Math.PI/6)).multiplyScalar(i)})),this._hexagons.push(H.allocate(K,s));case 3:case"end":return t.stop()}}),t,this)})),e._divideHexagonsIntoTriangles=a().mark((function t(){var e=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._hexagons.forEach((function(t){var n=t.center;t.points.forEach((function(t,i,r){var a=r[(i+1)%r.length];e._triangles.push(H.allocate(X,[n,t,a]))})),t.release()})),this._hexagons.length=0;case 2:case"end":return t.stop()}}),t,this)})),e._randomlyMergeTriangles=a().mark((function t(){var e,n,i,r,s,o=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=[],n=new Set,this._triangles.forEach((function(t){t.calcEdgeHash(),t.edgeHashs.forEach((function(t){n.has(t)?e.push(t):n.add(t)}))})),O(e),i=[f(),f(),f(),f()],r=new Set,s=a().mark((function t(){var n,s,u,c,h;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.clear(),n=e.pop(),s=o._triangles.findIndex((function(t){return-1!==t.edgeHashs.indexOf(n)})),(u=o._triangles.splice(s,1)[0]).edgeHashs.forEach((function(t){-1!==e.indexOf(t)&&e.splice(e.indexOf(t),1)})),c=o._triangles.findIndex((function(t){return-1!==t.edgeHashs.indexOf(n)})),(h=o._triangles.splice(c,1)[0]).edgeHashs.forEach((function(t){-1!==e.indexOf(t)&&e.splice(e.indexOf(t),1)})),u.points.forEach((function(t,e){i[e].set(t),r.add(q.Point(t))})),h.points.forEach((function(t){r.has(q.Point(t))||i[3].set(t)})),u.release(),h.release(),o._polygons.push(H.allocate(j,i)),void(t.next=15);case 15:case"end":return t.stop()}}),t)}));case 7:if(!(e.length>0)){t.next=11;break}return t.delegateYield(s(),"t0",9);case 9:t.next=7;break;case 11:this._triangles.forEach((function(t){o._polygons.push(H.allocate(X,t.points)),t.release()})),this._triangles.length=0;case 13:case"end":return t.stop()}}),t,this)})),e._subdivideIntoQuads=a().mark((function t(){var e,n,i=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=f(),n=f(),this._polygons.forEach((function(t){t.points.forEach((function(r,a,s){var o=s[(a-1+s.length)%s.length],u=s[(a+1)%s.length];e.set(o).add(r).multiplyScalar(.5),n.set(u).add(r).multiplyScalar(.5),i.quads.push(H.allocate(j,[t.center,e,r,n]))})),t.release()})),this._polygons.length=0;case 4:case"end":return t.stop()}}),t,this)})),e._smoothQuads=a().mark((function t(){var e,n,i,r,s,o,u,c=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=new Map,n=f(),i=f(),r=this.quads.length-1,s=a().mark((function t(){var s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=c.quads[r],r--,i.set(0,0),s.points.forEach((function(t,e){i.add(n.set(t).subtract(s.center).rotate(-e*Math.PI/2).multiplyScalar(.25))})),s.points.forEach((function(t,r){var a=q.Point(t);e.has(a)||e.set(a,[]),n.set(t).subtract(s.center),e.get(a).push(i.clone().rotate(r*Math.PI/2).subtract(n))})),void(t.next=7);case 7:case"end":return t.stop()}}),t)}));case 5:if(!(r>=0)){t.next=9;break}return t.delegateYield(s(),"t0",7);case 7:t.next=5;break;case 9:o=new Map,e.forEach((function(t,e){o.set(e,f(t.reduce((function(t,e){return t+e.x}),0)/t.length,t.reduce((function(t,e){return t+e.y}),0)/t.length))})),r=this.quads.length-1;case 12:if(!(r>=0)){t.next=21;break}return u=this.quads[r],r--,u.points.forEach((function(t){return t.add(o.get(q.Point(t)))})),u.resetCenter(),void(t.next=19);case 19:t.next=12;break;case 21:case"end":return t.stop()}}),t,this)})),e._filterQuads=a().mark((function t(e,n){var i,r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=[];case 1:if(!this.quads.length){t.next=8;break}return(r=this.quads.pop()).points.every((function(t){return 0<t.x&&t.x<e&&0<t.y&&t.y<n}))?i.push(r):r.release(),void(t.next=6);case 6:t.next=1;break;case 8:this.quads=i;case 9:case"end":return t.stop()}}),t,this)})),e._groupingQuads=a().mark((function t(){var e,n,i,r,s,o,u,c,h=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=[],n=new Set,this.quads.forEach((function(t){t.calcEdgeHash(),t.edgeHashs.forEach((function(t){n.has(t)?e.push(t):n.add(t)}))})),void(t.next=5);case 5:return i=[],this.quads.forEach((function(t){t.edgeHashs.every((function(t){return-1===e.indexOf(t)}))?t.release():i.push(t)})),this.quads=i,void(t.next=10);case 10:O(e),r=~~(.2*e.length),s=a().mark((function t(){var n,i,r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.pop(),i=h.quads.findIndex((function(t){return-1!==t.edgeHashs.indexOf(n)})),r=h.quads.findIndex((function(t,e){return e!==i&&-1!==t.edgeHashs.indexOf(n)})),h.groups.push([i,r]),h.quads[i].edgeHashs.forEach((function(t){-1!==e.indexOf(t)&&e.splice(e.indexOf(t),1)})),h.quads[r].edgeHashs.forEach((function(t){-1!==e.indexOf(t)&&e.splice(e.indexOf(t),1)})),void(t.next=8);case 8:case"end":return t.stop()}}),t)}));case 13:if(!(e.length>r)){t.next=17;break}return t.delegateYield(s(),"t0",15);case 15:t.next=13;break;case 17:o=Array(this.quads.length).fill(!0),this.groups.forEach((function(t){return t.forEach((function(t){return o[t]=!1}))})),u=[],o.forEach((function(t,e){t&&u.push(e)})),O(u),c=a().mark((function t(){var e,n,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=u.pop(),-1!==(n=h.groups.findIndex((function(t){return h.quads[e].edgeHashs.some((function(e){return t.some((function(t){return-1!==h.quads[t].edgeHashs.indexOf(e)}))}))})))?(h.groups[n].length>8?h.groups.push([e]):h.groups[n].push(e),h.groups.sort((function(t,e){return t.length-e.length}))):u.unshift(e),void(t.next=5);case 5:t.sent&&((i=h.groups).push.apply(i,u.map((function(t){return[t]}))),u.length=0);case 7:case"end":return t.stop()}}),t)}));case 23:if(!(u.length>0)){t.next=27;break}return t.delegateYield(c(),"t1",25);case 25:t.next=23;break;case 27:case"end":return t.stop()}}),t,this)})),t}())||J;function $(t){return tt.apply(this,arguments)}function tt(){return(tt=s(a().mark((function t(e){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t,n){g.loadBundle(e,(function(e,n){t(e?null:n)}))}));case 2:return n=t.sent,t.abrupt("return",null!=n?n:$(e));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function et(t,e){return nt.apply(this,arguments)}function nt(){return(nt=s(a().mark((function t(e,n){var i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===n&&(n=g.resources),t.next=3,new Promise((function(t,i){n.load(e,(function(e,n){e?i(e):t(n)}))}));case 3:return i=t.sent,t.abrupt("return",null!=i?i:et(e,n));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}h._RF.pop(),h._RF.push({},"f383d5Sp7ZF4oqFS4WpWbtm","promisify",void 0),h._RF.pop(),h._RF.push({},"ac3ee+vtNdO+KJ3c4DV7Fhf","game-manager",void 0);var it=function(){function n(){this.mesh=void 0,this.level=1,this.gridSize=60}var r=n.prototype;return r.play=function(){var n=s(a().mark((function n(i,r){return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.level=i,this.gridSize=r,n.next=4,Promise.all([this._loadRes(),this._loadScene()]);case 4:return n.next=6,this._createMesh();case 6:t.emit(e.GAME_START);case 7:case"end":return n.stop()}}),n,this)})));return function(t,e){return n.apply(this,arguments)}}(),r._loadRes=function(){var t=s(a().mark((function t(){var e;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,$(this.bundleName);case 2:return e=t.sent,t.next=5,et("scene",e);case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),r._createMesh=function(){var t=s(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.mesh=H.allocate(Z,this.gridSize),t.next=3,this.mesh.generate();case 3:if(t.sent){t.next=7;break}return this.mesh.release(),t.abrupt("return",this._createMesh());case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),r._loadScene=function(){var t=s(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){v.loadScene("game",(function(){return t()}))})));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),r.reset=function(){var t;null==(t=this.mesh)||t.release()},i(n,[{key:"bundleName",get:function(){return"level-"+("00"+this.level.toString()).slice(-3)}}]),n}();h._RF.pop(),h._RF.push({},"190c5yvJhJNd7l9CE/cyqxc","ui-manager",void 0);var rt=function(){function t(){}var e=t.prototype;return e.showUI=function(){var t=s(a().mark((function t(e){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,et("ui/"+e);case 2:n=t.sent,this.root.addChild(m(n));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),e.hideUI=function(t){var e;null==(e=this.root.getChildByName(t))||e.removeFromParent()},e.showLoading=function(){},e.hideLoading=function(){},e.showModal=function(t){alert(t)},i(t,[{key:"root",get:function(){return v.getScene().getComponentInChildren(_).node}}]),t}();h._RF.pop(),h._RF.push({},"7236fc3qapByZ+xcgnWNj7G","neko",void 0);var at,st,ot,ut,ct={ui:new rt,game:new it,audio:new L,init:function(t){l.ENABLE_MULTI_TOUCH=!1,v.addPersistRootNode(t.node),H.init(),N=t,n(t.node)}};h._RF.pop(),h._RF.push({},"fe05fXSotdFcYCVnXs2x4Gh","get-random-points",void 0),h._RF.pop(),h._RF.push({},"bb277MvMnBPnJIYMoIU66X1","image-piece",void 0);var ht=y.ccclass,lt=y.property,pt=(at=ht("ImagePiece"),st=lt(b),at((o((ut=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).pointList=void 0,e.outlineList=void 0,e.outlintColor=E(0,0,0,100),e._outline=!0,e}r(e,t);var n=e.prototype;return n.setData=function(t,e){this.pointList=t,this.outlineList=e,this.markForUpdateRenderData()},n._flushAssembler=function(){this._assembler!==mt&&(this.destroyRenderData(),this._assembler=mt),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.getRenderMaterial(0),this.markForUpdateRenderData(),this.spriteFrame&&this._assembler.updateUVs(this),this._updateColor())},i(e,[{key:"outline",get:function(){return this._outline},set:function(t){var e=t!==this._outline;this._outline=t,e&&this.pointList&&this.outlineList&&this.markForUpdateRenderData()}}]),e}(R)).prototype,"outline",[st],Object.getOwnPropertyDescriptor(ut.prototype,"outline"),ut.prototype),ot=ut))||ot),dt=null,ft=new x,gt=new w;function vt(t,e,n){return Math.min(e,Math.max(t,n))}var _t,mt=new(function(){function t(){}var e=t.prototype;return e.createData=function(t){return t.requestRenderData()},e.updateRenderData=function(t){if(t.pointList&&t.pointList){var e=t.spriteFrame,n=t.renderData;if(this.updateUVs(t),e&&n&&n.vertDirty){var i=t.outline?2:1;n.dataLength=t.pointList.length*i,n.resize(t.pointList.length*i,t.pointList.length*i/4*6);var r=n.indexCount;this.createQuadIndices(r),n.chunk.setIndexBuffer(dt),this.calculateVertices(t),this.calculateUVs(t),this.updateWorldUVData(t),n.updateRenderData(t,e)}}},e.createQuadIndices=function(t){var e=t/6;dt=new Uint16Array(t);for(var n=0,i=0;i<e;i++)dt[n++]=0+4*i,dt[n++]=1+4*i,dt[n++]=2+4*i,dt[n++]=1+4*i,dt[n++]=3+4*i,dt[n++]=2+4*i},e.fillBuffers=function(t){if(t.pointList&&t.pointList){var e=t.renderData,n=e.chunk;(t._flagChangedVersion!==t.node.flagChangedVersion||e.vertDirty)&&(this.updateWorldVertexAndUVData(t,n),e.vertDirty=!1,t._flagChangedVersion=t.node.flagChangedVersion),this.updateColorLate(t);for(var i=n.meshBuffer,r=n.meshBuffer.iData,a=n.vertexOffset,s=i.indexOffset,o=0;o<e.indexCount;o+=6)r[s++]=a+0,r[s++]=a+1,r[s++]=a+2,r[s++]=a+1,r[s++]=a+3,r[s++]=a+2,a+=4,i.indexOffset+=6;i.setDirty()}},e.updateWorldUVData=function(t){for(var e=t.renderData,n=e.floatStride,i=e.data,r=e.chunk.vb,a=0;a<i.length;a++){var s=a*n;r[s+3]=i[a].u,r[s+4]=i[a].v}},e.updateWorldVertexAndUVData=function(t,e){if(t.pointList&&t.pointList){t.node.getWorldMatrix(ft);for(var n=t.renderData,i=n.floatStride,r=n.data,a=e.vb,s=n.vertexCount,o=0,u=0;u<s;u++){var c=r[u].x,h=r[u].y,l=ft.m03*c+ft.m07*h+ft.m15;l=l?1/l:1,a[o+0]=(ft.m00*c+ft.m04*h+ft.m12)*l,a[o+1]=(ft.m01*c+ft.m05*h+ft.m13)*l,a[o+2]=(ft.m02*c+ft.m06*h+ft.m14)*l,a[o+3]=r[u].u,a[o+4]=r[u].v,o+=i}}},e.updateUVs=function(t){t.renderData.vertDirty=!0,t.markForUpdateRenderData()},e.updateColorLate=function(t){if(t.pointList&&t.pointList)for(var e=t.renderData,n=e.floatStride,i=e.data,r=e.chunk.vb,a=e.vertexCount,s=5,o=0;o<a;o++)r[s+0]=i[o].color.r/255,r[s+1]=i[o].color.g/255,r[s+2]=i[o].color.b/255,r[s+3]=i[o].color.a/255,s+=n},e.updateColor=function(t){},e.calculateVertices=function(t){var e,n=t.node._uiProps.uiTransformComp,i=t.renderData.data,r=n.contentSize,a=t.pointList.length;if(t.outline){e=t.outlineList;for(var s=0;s<a;s+=8)this._setVerticeData(i[s+0],s,e,r,t.outlintColor),this._setVerticeData(i[s+1],s+2,e,r,t.outlintColor),this._setVerticeData(i[s+2],s+6,e,r,t.outlintColor),this._setVerticeData(i[s+3],s+4,e,r,t.outlintColor)}e=t.pointList;for(var o=t.outline?a:0,u=0;u<a;u+=8)this._setVerticeData(i[o+u+0],u,e,r,t.color),this._setVerticeData(i[o+u+1],u+2,e,r,t.color),this._setVerticeData(i[o+u+2],u+6,e,r,t.color),this._setVerticeData(i[o+u+3],u+4,e,r,t.color)},e._setVerticeData=function(t,e,n,i,r){t.x=n[e+0]-i.width/2,t.y=n[e+1]-i.height/2,t.u=vt(0,1,n[e+0]/i.width),t.v=1-vt(0,1,n[e+1]/i.height),t.color.set(r)},e.calculateUVs=function(t){t.node._uiProps.uiTransformComp,t.renderData;t.spriteFrame.getRect(gt)},t}());h._RF.pop(),h._RF.push({},"57514vMKnxGUZHRoB8/yrS2","piece",void 0);var yt,bt=H.register()(_t=function(){function n(){this.local=F(),this._select=!1,this.node=void 0,this.center=f(),this.quads=void 0,this.ui=void 0,this.img=void 0,this.aabb=[0,0,0,0],this._edge=f(),this._origin=F(0,0,0)}var r=n.prototype;return r.initialize=function(t,e,n){void 0===n&&(n=!0),this.quads=e,this._setNode(t),this._setImg(n),this._setAABB()},r.release=function(){this.quads.length=0,this._select=!1,this.node.setPosition(0,0),this.node.removeFromParent(),this.ui.unscheduleAllCallbacks()},r.contains=function(t){var e=this;return this.ui.convertToNodeSpaceAR(t,this.local),this.local.add3f(this.ui.contentSize.width/2,this.ui.contentSize.height/2,0),!(this.local.x<this.aabb[0]||this.local.y<this.aabb[1]||this.aabb[2]<this.local.x||this.aabb[3]<this.local.y)&&this.quads.some((function(t){return t.contains(e.local)}))},r.setPosition=function(t,e){2===arguments.length&&this.node.setPosition(t,e)},r._setImg=function(t){var e=this,n=new Map,i=new Map,r=new Float64Array(4*this.quads.length*2),a=new Float64Array(4*this.quads.length*2);this.quads.forEach((function(t,i){t.points.forEach((function(t,a,s){r[8*i+2*a+0]=t.x,r[8*i+2*a+1]=t.y;var o=s[(s.length+1+a)%s.length];e._edge.set(t).subtract(o).rotate(Math.PI/2).normalize();var u=q.Point(t);n.has(u)||n.set(u,[]),n.get(u).push(e._edge.x,e._edge.y),u=q.Point(o),n.has(u)||n.set(u,[]),n.get(u).push(e._edge.x,e._edge.y)}))})),this.quads.forEach((function(t,r){t.points.forEach((function(t,s){var o=q.Point(t);if(!i.has(o)){var u=n.get(o);e._edge.set(0,0);for(var c=0;c<u.length;c+=2)e._edge.add2f(u[c],u[c+1]);e._edge.normalize().multiplyScalar(2),i.set(o,[e._edge.x,e._edge.y])}var h=i.get(o);a[8*r+2*s+0]=h[0]+t.x,a[8*r+2*s+1]=h[1]+t.y}))})),this.img.outline=t,this.img.setData(r,a)},r._setNode=function(t){this.node||(this.node=m(t),this.img=this.node.getComponent(pt),this.ui=this.node.getComponent(I))},r._setAABB=function(){var t=this;this.aabb[0]=Number.POSITIVE_INFINITY,this.aabb[1]=Number.POSITIVE_INFINITY,this.aabb[2]=Number.NEGATIVE_INFINITY,this.aabb[3]=Number.NEGATIVE_INFINITY,this.quads.forEach((function(e){return e.points.forEach((function(e){t.aabb[0]=Math.min(e.x,t.aabb[0]),t.aabb[1]=Math.min(e.y,t.aabb[1]),t.aabb[2]=Math.max(e.x,t.aabb[2]),t.aabb[3]=Math.max(e.y,t.aabb[3])}))})),this.center.set((this.aabb[0]+this.aabb[2])/2,(this.aabb[1]+this.aabb[3])/2)},r._move=function(n){this.node.setPosition(this._origin.x+n.x,this._origin.y+n.y),this.node.position.length()<8&&(this.img.outline=!1,t.emit(e.PLACE_SUCCESS,this))},i(n,[{key:"select",get:function(){return this._select},set:function(n){n?(this._origin.set(this.node.position),t.on(e.TOUCH_MOVE,this._move,this)):(this.setPosition(),t.off(e.TOUCH_MOVE,this._move,this)),this._select=n}}]),n}())||_t;h._RF.pop(),h._RF.push({},"7c5d9zIV5BGirnXji4akO1i","shadow",void 0);var xt,wt,Et,Rt,It,Ft,Ct,Tt,kt,Mt,St,Pt,Dt,At,Nt,Lt,Vt,zt=H.register()(yt=function(){function t(){this.node=void 0,this.img=void 0,this.ui=void 0}var e=t.prototype;return e.initialize=function(t,e){this._setNode(t),this._setImg(e)},e.release=function(){this.node.removeFromParent(),this.ui.unscheduleAllCallbacks()},e._setImg=function(t){var e=new Float64Array(4*t.length*2);t.forEach((function(t,n){t.points.forEach((function(t,i){e[8*n+2*i+0]=t.x,e[8*n+2*i+1]=t.y}))})),this.img.outline=!1,this.img.setData(e,e)},e._setNode=function(t){this.node||(this.node=m(t),this.img=this.node.getComponent(pt),this.ui=this.node.getComponent(I))},t}())||yt;h._RF.pop(),h._RF.push({},"46cafT94rVCPZG3NRk4IHmC","puzzle",void 0);var Ot,qt,Ut,Ht,Gt,Bt,Yt=y.ccclass,Wt=y.property,Kt=(xt=Yt("Puzzle"),wt=Wt(C),Et=Wt(T),Rt=Wt(T),It=Wt(k),Ft=Wt(k),Ct=Wt(k),Tt=Wt(k),xt((St=o((Mt=function(n){function i(){for(var t,e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];return t=n.call.apply(n,[this].concat(i))||this,u(t,"camera",St,c(t)),u(t,"piecePrefab",Pt,c(t)),u(t,"shadowPrefab",Dt,c(t)),u(t,"piecesParent",At,c(t)),t.pieces=[],u(t,"shadowsParent",Nt,c(t)),t.shadows=[],u(t,"placedParent",Lt,c(t)),t.placed=[],u(t,"root",Vt,c(t)),t._process=void 0,t}r(i,n);var o=i.prototype;return o.onEnable=function(){t.on(e.GAME_START,this._gameStart,this),t.on(e.TOUCH_START,this._touchStart,this),t.on(e.TOUCH_END,this._touchEnd,this),t.on(e.PLACE_SUCCESS,this._placeSuccess,this)},o.onDisable=function(){this.clear(),t.targetOff(this)},o.clear=function(){var t;null==(t=this._process)||t.clear(),this.pieces.forEach((function(t){return t.release()})),this.pieces.length=0,this.shadows.forEach((function(t){return t.release()})),this.shadows.length=0,this.placed.forEach((function(t){return t.release()})),this.placed.length=0},o._gameStart=function(){var t=s(a().mark((function t(){var e;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._renderScene(),t.next=3,this._renderPuzzle();case 3:null!=(e=this.node)&&e.isValid&&(this.camera.enabled=!0);case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),o._renderScene=function(){var t=g.getBundle(ct.game.bundleName).get("scene",T);this.root.addChild(m(t))},o._renderPuzzle=function(){var t=a().mark(r),e=M.getVisibleSize(),n=function(t,e,n,i){void 0===i&&(i=10);for(var r=[f(Math.random()*e,Math.random()*n)],a=f();r.length<t;){for(var s=f(),o=i,u=0;o;){o--,a.set(Math.random()*e,Math.random()*n);var c=Math.min.apply(Math,r.map((function(t){return p.squaredDistance(t,a)})));c>u&&(u=c,s.set(a))}r.push(s)}return r}(ct.game.mesh.groups.length,(e.width-U)/2,720),i=ct.game.mesh.groups.length;function r(){var r,s,o,u;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(i>0&&null!=(r=this.node)&&r.isValid)){t.next=17;break}return i--,s=H.allocate(bt,this.piecePrefab,ct.game.mesh.groups[i].map((function(t){return ct.game.mesh.quads[t]}))),(o=n.pop()).add2f(Math.random()>.5?U:360-e.width/2,0).subtract2f(s.center.x,s.center.y),this.piecesParent.addChild(s.node),this.pieces.push(s),s.setPosition(o.x,o.y),void(t.next=10);case 10:return u=H.allocate(zt,this.shadowPrefab,ct.game.mesh.groups[i].map((function(t){return ct.game.mesh.quads[t]}))),this.shadowsParent.addChild(u.node),this.shadows.push(u),void(t.next=15);case 15:t.next=0;break;case 17:case"end":return t.stop()}}),t,this)}return this._process=new z(r.call(this),12),this._process.autoRun()},o._touchStart=function(t){var e;this.pieces.sort((function(t,e){return e.node.getSiblingIndex()-t.node.getSiblingIndex()}));var n=this.pieces.findIndex((function(e){return e.contains(t)}));null==(e=this.pieces)||e.forEach((function(t,e){t.select=n===e,t.select&&t.node.setSiblingIndex(-1)}))},o._touchEnd=function(){var t;null==(t=this.pieces)||t.forEach((function(t){t.select=!1}))},o._placeSuccess=function(n){this.pieces.splice(this.pieces.indexOf(n),1),n.node.setSiblingIndex(0),n.setPosition(0,0),n.select=!1,n.node.parent=this.placedParent,this.placed.push(n),0===this.pieces.length&&t.emit(e.GAME_OVER)},i}(S)).prototype,"camera",[wt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pt=o(Mt.prototype,"piecePrefab",[Et],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dt=o(Mt.prototype,"shadowPrefab",[Rt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),At=o(Mt.prototype,"piecesParent",[It],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nt=o(Mt.prototype,"shadowsParent",[Ft],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lt=o(Mt.prototype,"placedParent",[Ct],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vt=o(Mt.prototype,"root",[Tt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kt=Mt))||kt);h._RF.pop(),h._RF.push({},"5caceq09MNE2ZJq162z9P3m","debug",void 0);var Qt,jt=y.ccclass,Jt=y.property,Xt=y.requireComponent;Ot=jt("Debug"),qt=Xt(P),Ut=Jt(Kt),Ot(Ht=qt((Bt=o((Gt=function(n){function i(){for(var t,e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];return t=n.call.apply(n,[this].concat(i))||this,u(t,"puzzle",Bt,c(t)),t.graph=void 0,t.colors=[],t}r(i,n);var a=i.prototype;return a.onLoad=function(){var n=this;this.graph=this.node.getComponent(P),t.on(e.SWITCH_DEBUG,(function(){n.node.active=!n.node.active}),this)},a.update=function(){var t=this;this.graph.clear(),this.graph.fillColor=D.RED,this.puzzle.pieces.forEach((function(e){t.graph.circle(e.center.x,e.center.y,3),t.graph.fill()}))},i}(S)).prototype,"puzzle",[Ut],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ht=Gt))||Ht);function Zt(t,e){var n;return function(){n||(t.apply(this,arguments),n=setTimeout((function(){clearTimeout(n),n=null}),e))}}h._RF.pop(),h._RF.push({},"86bde9MiPdHfJw+o4NZeJXk","debounce",void 0),h._RF.pop(),h._RF.push({},"7cfa741Kg5Mgp2skxqaMUfS","gesture",void 0);var $t;(0,y.ccclass)("Gesture")(Qt=function(n){function i(){for(var i,r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(i=n.call.apply(n,[this].concat(a))||this).pos=F(),i._touchMove=Zt((function(n){i.pos.set(n.getUILocation().x,n.getUILocation().y),i.pos.subtract3f(n.getUIStartLocation().x,n.getUIStartLocation().y,0),t.emit(e.TOUCH_MOVE,i.pos)}),8),i}r(i,n);var a=i.prototype;return a.onLoad=function(){this.node.on(k.EventType.TOUCH_START,this._touchStart.bind(this)),this.node.on(k.EventType.TOUCH_MOVE,this._touchMove.bind(this)),this.node.on(k.EventType.TOUCH_END,this._touchEnd.bind(this)),this.node.on(k.EventType.TOUCH_CANCEL,this._touchEnd.bind(this))},a._touchStart=function(n){this.pos.set(n.getUILocation().x,n.getUILocation().y),t.emit(e.TOUCH_START,this.pos)},a._touchEnd=function(n){t.emit(e.TOUCH_END)},i}(S));h._RF.pop(),h._RF.push({},"ceaa1kk4otB8rNjkBGumG1C","main",void 0);var te;(0,y.ccclass)("Main")($t=function(t){function e(){return t.apply(this,arguments)||this}return r(e,t),e.prototype.onLoad=function(){ct.init(this)},e}(S));h._RF.pop(),h._RF.push({},"b07bdkvnFJH4IloCDESFV8l","home",void 0);var ee,ne,ie,re,ae,se=y.ccclass;y.property,se("Home")(te=function(t){function e(){return t.apply(this,arguments)||this}return r(e,t),e.prototype.play=function(){ct.game.play(1,60)},e}(S));function oe(t,e){var n;return function(){var i=arguments,r=this;n&&(clearTimeout(n),n=null),n=setTimeout((function(){t.apply(r,i)}),e)}}h._RF.pop(),h._RF.push({},"07cd2ThARxJKY7pzasgOmVr","throttle",void 0),h._RF.pop(),h._RF.push({},"50875s3OqRMHbT37Sr7O2ky","menu",void 0);var ue,ce=y.ccclass,he=y.property;ee=ce("Menu"),ne=he(A),ee((ae=o((re=function(n){function i(){for(var t,e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];return t=n.call.apply(n,[this].concat(i))||this,u(t,"slide",ae,c(t)),t._changeSize=oe(t.reset.bind(c(t)),100),t}r(i,n);var a=i.prototype;return a.onLoad=function(){this.slide.progress=(ct.game.gridSize-15)/45},a.reset=function(){var t;null!=(t=this.node)&&t.isValid&&ct.game.play(1,15+~~(45*this.slide.progress))},a.changeSize=function(t){this._changeSize(t)},a.switchDebug=function(){t.emit(e.SWITCH_DEBUG)},i}(S)).prototype,"slide",[ne],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ie=re));h._RF.pop(),h._RF.push({},"33537jb6AJGyo4TCso7TmjQ","welcome",void 0);var le=y.ccclass;y.property,le("Welcome")(ue=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).time=0,e}return r(e,t),e.prototype.update=function(){this.time++,60===this.time&&this.node.removeFromParent()},e}(S));h._RF.pop(),h._RF.push({},"b10573WEcBD/Y9LcoBh7v+L","simple-clone",void 0),h._RF.pop(),h._RF.push({},"ec3ffq26rVF548LQ4tF6Rpy","wait",void 0),h._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///main.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});