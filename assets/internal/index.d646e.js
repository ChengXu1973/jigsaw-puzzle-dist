System.register("chunks:///internal.js",["./rollupPluginModLoBabelHelpers-ec5e44d8.js","cc"],(function(){var e,a,t,i,o,s,r,n,l,d,h,c,p,g,u,m,f,_,b,S,P,R,w,M,y,T,C,E;return{setters:[function(r){e=r._,a=r.a,t=r.b,i=r.c,o=r.d,s=r.e},function(e){r=e.cclegacy,n=e.gfx,l=e._decorator,d=e.Camera,h=e.CCBoolean,c=e.CCInteger,p=e.CCFloat,g=e.Material,u=e.Texture2D,m=e.rendering,f=e.Component,_=e.geometry,b=e.renderer,S=e.Vec3,P=e.Vec4,R=e.Vec2,w=e.PipelineEventType,M=e.assert,y=e.clamp,T=e.sys,C=e.pipeline,E=e.Layers}],execute:function(){r._RF.push({},"cbf30kCUX9A3K+QpVC6wnzx","builtin-pipeline-types",void 0);var x,D,v,A,F,O,L,G,B,N,k,z,Q,I,H,V,U,W,j,X,Y,K,q,Z,J,$,ee,ae,te,ie,oe,se,re,ne,le=n.SampleCount;function de(){return{enabled:!1,sampleCount:le.X4}}function he(){return{msaa:de(),enableShadingScale:!1,shadingScale:.5,depthOfField:{enabled:!1,material:null,focusDistance:0,focusRange:0,bokehRadius:1},bloom:{enabled:!1,material:null,enableAlphaMask:!1,iterations:3,threshold:.8,intensity:2.3},toneMapping:{material:null},colorGrading:{enabled:!1,material:null,contribute:1,colorGradingMap:null},fsr:{enabled:!1,material:null,sharpness:.8},fxaa:{enabled:!1,material:null}}}function ce(e){e.msaa?function(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.sampleCount&&(e.sampleCount=le.X4)}(e.msaa):e.msaa=de(),void 0===e.enableShadingScale&&(e.enableShadingScale=!1),void 0===e.shadingScale&&(e.shadingScale=.5),e.depthOfField?function(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null),void 0===e.focusDistance&&(e.focusDistance=0),void 0===e.focusRange&&(e.focusRange=0),void 0===e.bokehRadius&&(e.bokehRadius=1)}(e.depthOfField):e.depthOfField={enabled:!1,material:null,focusDistance:0,focusRange:0,bokehRadius:1},e.bloom?function(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null),void 0===e.enableAlphaMask&&(e.enableAlphaMask=!1),void 0===e.iterations&&(e.iterations=3),void 0===e.threshold&&(e.threshold=.8),void 0===e.intensity&&(e.intensity=2.3)}(e.bloom):e.bloom={enabled:!1,material:null,enableAlphaMask:!1,iterations:3,threshold:.8,intensity:2.3},e.toneMapping?function(e){void 0===e.material&&(e.material=null)}(e.toneMapping):e.toneMapping={material:null},e.colorGrading?function(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null),void 0===e.contribute&&(e.contribute=1),void 0===e.colorGradingMap&&(e.colorGradingMap=null)}(e.colorGrading):e.colorGrading={enabled:!1,material:null,contribute:1,colorGradingMap:null},e.fsr?function(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null),void 0===e.sharpness&&(e.sharpness=.8)}(e.fsr):e.fsr={enabled:!1,material:null,sharpness:.8},e.fxaa?function(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null)}(e.fxaa):e.fxaa={enabled:!1,material:null}}r._RF.pop(),r._RF.push({},"de1c2EHcMhAIYRZY5nyTQHG","builtin-pipeline-settings",void 0);var pe=l.ccclass,ge=l.disallowMultiple,ue=l.executeInEditMode,me=l.menu,fe=l.property,_e=l.requireComponent,be=l.type;x=pe("BuiltinPipelineSettings"),D=me("Rendering/BuiltinPipelineSettings"),v=_e(d),A=fe(h),F=fe({displayName:"Editor Preview (Experimental)",type:h}),O=fe({group:{id:"MSAA",name:"Multisample Anti-Aliasing"},type:h}),L=fe({group:{id:"MSAA",name:"Multisample Anti-Aliasing",style:"section"},type:c,range:[2,4,2]}),G=fe({group:{id:"ShadingScale",name:"ShadingScale",style:"section"},type:h}),B=fe({tooltip:"i18n:postprocess.shadingScale",group:{id:"ShadingScale",name:"ShadingScale"},type:p,range:[.01,4,.01],slide:!0}),N=fe({group:{id:"DepthOfField",name:"DepthOfField (PostProcessing)",style:"section"},type:h,visible:!1}),k=fe({group:{id:"DepthOfField",name:"DepthOfField (PostProcessing)",style:"section"},type:g,visible:!1}),z=fe({group:{id:"DepthOfField",name:"DepthOfField (PostProcessing)",style:"section"},type:p,min:0,visible:!1}),Q=fe({group:{id:"DepthOfField",name:"DepthOfField (PostProcessing)",style:"section"},type:p,min:0,visible:!1}),I=be(p),H=fe({group:{id:"DepthOfField",name:"DepthOfField (PostProcessing)",style:"section"},type:p,range:[1,10,.01],slide:!0,visible:!1}),V=fe({group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:h}),U=fe({group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:g}),W=fe({tooltip:"i18n:bloom.enableAlphaMask",group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:h}),j=fe({tooltip:"i18n:bloom.iterations",group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:c,range:[1,6,1],slide:!0}),X=fe({tooltip:"i18n:bloom.threshold",group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:p,min:0}),Y=fe({group:{id:"Color Grading",name:"ColorGrading (LDR) (PostProcessing)",style:"section"},type:h}),K=fe({group:{id:"Color Grading",name:"ColorGrading (LDR) (PostProcessing)",style:"section"},type:g}),q=fe({tooltip:"i18n:color_grading.contribute",group:{id:"Color Grading",name:"ColorGrading (LDR) (PostProcessing)",style:"section"},type:p,range:[0,1,.01],slide:!0}),Z=fe({tooltip:"i18n:color_grading.originalMap",group:{id:"Color Grading",name:"ColorGrading (LDR) (PostProcessing)",style:"section"},type:u}),J=fe({group:{id:"FXAA",name:"Fast Approximate Anti-Aliasing (PostProcessing)",style:"section"},type:h}),$=fe({group:{id:"FXAA",name:"Fast Approximate Anti-Aliasing (PostProcessing)",style:"section"},type:g}),ee=fe({group:{id:"FSR",name:"FidelityFX Super Resolution",style:"section"},type:h}),ae=fe({group:{id:"FSR",name:"FidelityFX Super Resolution",style:"section"},type:g}),te=fe({group:{id:"FSR",name:"FidelityFX Super Resolution",style:"section"},type:p,range:[0,1,.01],slide:!0}),ie=fe({group:{id:"ToneMapping",name:"ToneMapping",style:"section"},type:g}),x(oe=D(oe=v(oe=ge(oe=ue((re=e((se=function(e){function s(){for(var a,o=arguments.length,s=new Array(o),r=0;r<o;r++)s[r]=arguments[r];return a=e.call.apply(e,[this].concat(s))||this,t(a,"_settings",re,i(a)),t(a,"_editorPreview",ne,i(a)),a}a(s,e);var r=s.prototype;return r.onEnable=function(){ce(this._settings),this.getComponent(d).camera.pipelineSettings=this._settings},r.onDisable=function(){this.getComponent(d).camera.pipelineSettings=null},r._tryEnableEditorPreview=function(){void 0!==m&&(this._editorPreview?m.setEditorPipelineSettings(this._settings):this._disableEditorPreview())},r._disableEditorPreview=function(){void 0!==m&&(m.getEditorPipelineSettings()===this._settings&&m.setEditorPipelineSettings(null))},o(s,[{key:"editorPreview",get:function(){return this._editorPreview},set:function(e){this._editorPreview=e}},{key:"MsaaEnable",get:function(){return this._settings.msaa.enabled},set:function(e){this._settings.msaa.enabled=e}},{key:"msaaSampleCount",get:function(){return this._settings.msaa.sampleCount},set:function(e){e=Math.pow(2,Math.ceil(Math.log2(Math.max(e,2)))),e=Math.min(e,4),this._settings.msaa.sampleCount=e}},{key:"shadingScaleEnable",get:function(){return this._settings.enableShadingScale},set:function(e){this._settings.enableShadingScale=e}},{key:"shadingScale",get:function(){return this._settings.shadingScale},set:function(e){this._settings.shadingScale=e}},{key:"dofEnable",get:function(){return this._settings.depthOfField.enabled},set:function(e){this._settings.depthOfField.enabled=e}},{key:"dofMaterial",get:function(){return this._settings.depthOfField.material},set:function(e){this._settings.depthOfField.material!==e&&(this._settings.depthOfField.material=e)}},{key:"dofFocusDistance",get:function(){return this._settings.depthOfField.focusDistance},set:function(e){this._settings.depthOfField.focusDistance=e}},{key:"dofFocusRange",get:function(){return this._settings.depthOfField.focusRange},set:function(e){this._settings.depthOfField.focusRange=e}},{key:"dofBokehRadius",get:function(){return this._settings.depthOfField.bokehRadius},set:function(e){this._settings.depthOfField.bokehRadius=e}},{key:"bloomEnable",get:function(){return this._settings.bloom.enabled},set:function(e){this._settings.bloom.enabled=e}},{key:"bloomMaterial",get:function(){return this._settings.bloom.material},set:function(e){this._settings.bloom.material!==e&&(this._settings.bloom.material=e)}},{key:"bloomEnableAlphaMask",get:function(){return this._settings.bloom.enableAlphaMask},set:function(e){this._settings.bloom.enableAlphaMask=e}},{key:"bloomIterations",get:function(){return this._settings.bloom.iterations},set:function(e){this._settings.bloom.iterations=e}},{key:"bloomThreshold",get:function(){return this._settings.bloom.threshold},set:function(e){this._settings.bloom.threshold=e}},{key:"bloomIntensity",get:function(){return this._settings.bloom.intensity},set:function(e){this._settings.bloom.intensity=e}},{key:"colorGradingEnable",get:function(){return this._settings.colorGrading.enabled},set:function(e){this._settings.colorGrading.enabled=e}},{key:"colorGradingMaterial",get:function(){return this._settings.colorGrading.material},set:function(e){this._settings.colorGrading.material!==e&&(this._settings.colorGrading.material=e)}},{key:"colorGradingContribute",get:function(){return this._settings.colorGrading.contribute},set:function(e){this._settings.colorGrading.contribute=e}},{key:"colorGradingMap",get:function(){return this._settings.colorGrading.colorGradingMap},set:function(e){this._settings.colorGrading.colorGradingMap=e}},{key:"fxaaEnable",get:function(){return this._settings.fxaa.enabled},set:function(e){this._settings.fxaa.enabled=e}},{key:"fxaaMaterial",get:function(){return this._settings.fxaa.material},set:function(e){this._settings.fxaa.material!==e&&(this._settings.fxaa.material=e)}},{key:"fsrEnable",get:function(){return this._settings.fsr.enabled},set:function(e){this._settings.fsr.enabled=e}},{key:"fsrMaterial",get:function(){return this._settings.fsr.material},set:function(e){this._settings.fsr.material!==e&&(this._settings.fsr.material=e)}},{key:"fsrSharpness",get:function(){return this._settings.fsr.sharpness},set:function(e){this._settings.fsr.sharpness=e}},{key:"toneMappingMaterial",get:function(){return this._settings.toneMapping.material},set:function(e){this._settings.toneMapping.material!==e&&(this._settings.toneMapping.material=e)}}]),s}(f)).prototype,"_settings",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return he()}}),ne=e(se.prototype,"_editorPreview",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),e(se.prototype,"editorPreview",[F],Object.getOwnPropertyDescriptor(se.prototype,"editorPreview"),se.prototype),e(se.prototype,"MsaaEnable",[O],Object.getOwnPropertyDescriptor(se.prototype,"MsaaEnable"),se.prototype),e(se.prototype,"msaaSampleCount",[L],Object.getOwnPropertyDescriptor(se.prototype,"msaaSampleCount"),se.prototype),e(se.prototype,"shadingScaleEnable",[G],Object.getOwnPropertyDescriptor(se.prototype,"shadingScaleEnable"),se.prototype),e(se.prototype,"shadingScale",[B],Object.getOwnPropertyDescriptor(se.prototype,"shadingScale"),se.prototype),e(se.prototype,"dofEnable",[N],Object.getOwnPropertyDescriptor(se.prototype,"dofEnable"),se.prototype),e(se.prototype,"dofMaterial",[k],Object.getOwnPropertyDescriptor(se.prototype,"dofMaterial"),se.prototype),e(se.prototype,"dofFocusDistance",[z],Object.getOwnPropertyDescriptor(se.prototype,"dofFocusDistance"),se.prototype),e(se.prototype,"dofFocusRange",[Q],Object.getOwnPropertyDescriptor(se.prototype,"dofFocusRange"),se.prototype),e(se.prototype,"dofBokehRadius",[I,H],Object.getOwnPropertyDescriptor(se.prototype,"dofBokehRadius"),se.prototype),e(se.prototype,"bloomEnable",[V],Object.getOwnPropertyDescriptor(se.prototype,"bloomEnable"),se.prototype),e(se.prototype,"bloomMaterial",[U],Object.getOwnPropertyDescriptor(se.prototype,"bloomMaterial"),se.prototype),e(se.prototype,"bloomEnableAlphaMask",[W],Object.getOwnPropertyDescriptor(se.prototype,"bloomEnableAlphaMask"),se.prototype),e(se.prototype,"bloomIterations",[j],Object.getOwnPropertyDescriptor(se.prototype,"bloomIterations"),se.prototype),e(se.prototype,"bloomThreshold",[X],Object.getOwnPropertyDescriptor(se.prototype,"bloomThreshold"),se.prototype),e(se.prototype,"colorGradingEnable",[Y],Object.getOwnPropertyDescriptor(se.prototype,"colorGradingEnable"),se.prototype),e(se.prototype,"colorGradingMaterial",[K],Object.getOwnPropertyDescriptor(se.prototype,"colorGradingMaterial"),se.prototype),e(se.prototype,"colorGradingContribute",[q],Object.getOwnPropertyDescriptor(se.prototype,"colorGradingContribute"),se.prototype),e(se.prototype,"colorGradingMap",[Z],Object.getOwnPropertyDescriptor(se.prototype,"colorGradingMap"),se.prototype),e(se.prototype,"fxaaEnable",[J],Object.getOwnPropertyDescriptor(se.prototype,"fxaaEnable"),se.prototype),e(se.prototype,"fxaaMaterial",[$],Object.getOwnPropertyDescriptor(se.prototype,"fxaaMaterial"),se.prototype),e(se.prototype,"fsrEnable",[ee],Object.getOwnPropertyDescriptor(se.prototype,"fsrEnable"),se.prototype),e(se.prototype,"fsrMaterial",[ae],Object.getOwnPropertyDescriptor(se.prototype,"fsrMaterial"),se.prototype),e(se.prototype,"fsrSharpness",[te],Object.getOwnPropertyDescriptor(se.prototype,"fsrSharpness"),se.prototype),e(se.prototype,"toneMappingMaterial",[ie],Object.getOwnPropertyDescriptor(se.prototype,"toneMappingMaterial"),se.prototype),oe=se))||oe)||oe)||oe)||oe);r._RF.pop(),r._RF.push({},"ff9b0GZzgRM/obMbHGfCNbk","builtin-pipeline",void 0);var Se=_.AABB,Pe=_.Sphere,Re=_.intersect,we=n.ClearFlagBit,Me=n.Color,ye=n.Format,Te=n.FormatFeatureBit,Ce=n.LoadOp,Ee=n.StoreOp,xe=n.TextureType,De=n.Viewport,ve=b.scene,Ae=ve.CameraUsage,Fe=ve.CSMLevel,Oe=ve.LightType;function Le(e){return!!(e.clearFlag&(we.COLOR|we.STENCIL<<1))}function Ge(e,a,t,i,o,s){e.shadowFixedArea||e.csmLevel===Fe.LEVEL_1?(o.left=0,o.top=0,o.width=Math.trunc(a),o.height=Math.trunc(t)):(o.left=Math.trunc(i%2*.5*a),o.top=s>0?Math.trunc(.5*(1-Math.floor(i/2))*t):Math.trunc(.5*Math.floor(i/2)*t),o.width=Math.trunc(.5*a),o.height=Math.trunc(.5*t)),o.left=Math.max(0,o.left),o.top=Math.max(0,o.top),o.width=Math.max(1,o.width),o.height=Math.max(1,o.height)}var Be=function(){this.isWeb=!1,this.isWebGL1=!1,this.isWebGPU=!1,this.isMobile=!1,this.isHDR=!1,this.useFloatOutput=!1,this.toneMappingType=0,this.shadowEnabled=!1,this.shadowMapFormat=ye.R32F,this.shadowMapSize=new R(1,1),this.usePlanarShadow=!1,this.screenSpaceSignY=1,this.supportDepthSample=!1,this.mobileMaxSpotLightShadowMaps=1,this.platform=new P(0,0,0,0)};function Ne(e,a){var t=Te.SAMPLED_TEXTURE|Te.LINEAR_FILTER,i=e.device;a.isWeb=!T.isNative,a.isWebGL1=i.gfxAPI===n.API.WEBGL,a.isWebGPU=i.gfxAPI===n.API.WEBGPU,a.isMobile=T.isMobile,a.isHDR=e.pipelineSceneData.isHDR,a.useFloatOutput=e.getMacroBool("CC_USE_FLOAT_OUTPUT"),a.toneMappingType=e.pipelineSceneData.postSettings.toneMappingType;var o=e.pipelineSceneData.shadows;a.shadowEnabled=o.enabled,a.shadowMapFormat=C.supportsR32FloatTexture(e.device)?ye.R32F:ye.RGBA8,a.shadowMapSize.set(o.size),a.usePlanarShadow=o.enabled&&o.type===b.scene.ShadowType.Planar,a.screenSpaceSignY=e.device.capabilities.screenSpaceSignY,a.supportDepthSample=(e.device.getFormatFeatures(ye.DEPTH_STENCIL)&t)===t;var s=i.capabilities.screenSpaceSignY;a.platform.x=a.isMobile?1:0,a.platform.w=.5*s+.5<<1|.5*i.capabilities.clipSpaceSignY+.5}var ke=he(),ze=function(){this.colorName="",this.depthStencilName="",this.enableMainLightShadowMap=!1,this.enableMainLightPlanarShadowMap=!1,this.enablePostProcess=!1,this.enableProfiler=!1,this.enableShadingScale=!1,this.enableMSAA=!1,this.enableDOF=!1,this.enableBloom=!1,this.enableColorGrading=!1,this.enableFXAA=!1,this.enableFSR=!1,this.enableHDR=!1,this.enablePlanarReflectionProbe=!1,this.useFullPipeline=!1,this.singleForwardRadiancePass=!1,this.radianceFormat=n.Format.RGBA8,this.shadingScale=.5,this.settings=ke};function Qe(e,a,t){t.enableDOF=e.supportDepthSample&&a.depthOfField.enabled&&!!a.depthOfField.material,t.enableBloom=a.bloom.enabled&&!!a.bloom.material,t.enableColorGrading=a.colorGrading.enabled&&!!a.colorGrading.material&&!!a.colorGrading.colorGradingMap,t.enableFXAA=a.fxaa.enabled&&!!a.fxaa.material,t.enablePostProcess=t.enableDOF||t.enableBloom||t.enableColorGrading||t.enableFXAA}function Ie(e,a,t){var i=e.window,o=e.cameraUsage===Ae.GAME&&!!i.swapchain,s=e.cameraUsage===Ae.SCENE_VIEW||e.cameraUsage===Ae.PREVIEW;if(t.colorName=i.colorName,t.depthStencilName=i.depthStencilName,t.useFullPipeline=0!=(e.visibility&E.Enum.DEFAULT),t.enableMainLightShadowMap=a.shadowEnabled&&!a.usePlanarShadow&&!!e.scene&&!!e.scene.mainLight&&e.scene.mainLight.shadowEnabled,t.enableMainLightPlanarShadowMap=a.shadowEnabled&&a.usePlanarShadow&&!!e.scene&&!!e.scene.mainLight&&e.scene.mainLight.shadowEnabled,t.enablePlanarReflectionProbe=o||e.cameraUsage===Ae.SCENE_VIEW,t.enableProfiler=false,t.settings=e.pipelineSettings?e.pipelineSettings:ke,Qe(a,t.settings,t),s){var r=m.getEditorPipelineSettings();r&&(t.settings=r,Qe(a,t.settings,t))}t.enableMSAA=t.settings.msaa.enabled&&!a.isWeb&&!a.isWebGL1,t.shadingScale=t.settings.shadingScale,t.enableShadingScale=t.settings.enableShadingScale&&1!==t.shadingScale,t.enableFSR=t.settings.fsr.enabled&&!!t.settings.fsr.material&&t.enableShadingScale&&t.shadingScale<1,t.singleForwardRadiancePass=a.isMobile||t.enableMSAA,t.enableHDR=t.useFullPipeline&&a.useFloatOutput,t.radianceFormat=t.enableHDR?n.Format.RGBA16F:n.Format.RGBA8}if(m){var He=m.QueueHint,Ve=m.SceneFlags,Ue=m.ResourceFlags,We=m.ResourceResidency,je=function(){function e(){this.lights=[],this.shadowEnabledSpotLights=[],this._sphere=Pe.create(0,0,0,1),this._boundingBox=new Se,this._rangedDirLightBoundingBox=new Se(0,0,0,.5,.5,.5)}var a=e.prototype;return a.cullLights=function(e,a,t){this.lights.length=0,this.shadowEnabledSpotLights.length=0;for(var i,o=s(e.spotLights);!(i=o()).done;){var r=i.value;r.baked||(Pe.set(this._sphere,r.position.x,r.position.y,r.position.z,r.range),Re.sphereFrustum(this._sphere,a)&&(r.shadowEnabled?this.shadowEnabledSpotLights.push(r):this.lights.push(r)))}for(var n,l=s(e.sphereLights);!(n=l()).done;){var d=n.value;d.baked||(Pe.set(this._sphere,d.position.x,d.position.y,d.position.z,d.range),Re.sphereFrustum(this._sphere,a)&&this.lights.push(d))}for(var h,c=s(e.pointLights);!(h=c()).done;){var p=h.value;p.baked||(Pe.set(this._sphere,p.position.x,p.position.y,p.position.z,p.range),Re.sphereFrustum(this._sphere,a)&&this.lights.push(p))}for(var g,u=s(e.rangedDirLights);!(g=u()).done;){var m=g.value;Se.transform(this._boundingBox,this._rangedDirLightBoundingBox,m.node.getWorldMatrix()),Re.aabbFrustum(this._boundingBox,a)&&this.lights.push(m)}t&&this.shadowEnabledSpotLights.sort((function(e,a){return S.squaredDistance(t,e.position)-S.squaredDistance(t,a.position)}))},a._addLightQueues=function(e,a){for(var t,i=s(this.lights);!(t=i()).done;){var o=t.value,r=a.addQueue(He.BLEND,"forward-add");switch(o.type){case Oe.SPHERE:r.name="sphere-light";break;case Oe.SPOT:r.name="spot-light";break;case Oe.POINT:r.name="point-light";break;case Oe.RANGED_DIRECTIONAL:r.name="ranged-directional-light";break;default:r.name="unknown-light"}r.addScene(e,Ve.BLEND,o)}},a.addSpotlightShadowPasses=function(e,a,t){for(var i,o=0,r=s(this.shadowEnabledSpotLights);!(i=r()).done;){var n=i.value,l=e.pipelineSceneData.shadows.size,d=e.addRenderPass(l.x,l.y,"default");if(d.name="SpotLightShadowPass"+o,d.addRenderTarget("SpotShadowMap"+o,Ce.CLEAR,Ee.STORE,new Me(1,1,1,1)),d.addDepthStencil("SpotShadowDepth"+o,Ce.CLEAR,Ee.DISCARD),d.addQueue(He.NONE,"shadow-caster").addScene(a,Ve.OPAQUE|Ve.MASK|Ve.SHADOW_CASTER).useLightFrustum(n),++o>=t)break}},a.addLightQueues=function(e,a,t){this._addLightQueues(a,e);for(var i,o=0,r=s(this.shadowEnabledSpotLights);!(i=r()).done;){var n=i.value;if(e.addTexture("SpotShadowMap"+o,"cc_spotShadowMap"),e.addQueue(He.BLEND,"forward-add").addScene(a,Ve.BLEND,n),++o>=t)break}},a.addLightPasses=function(e,a,t,i,o,r,n,l,d,h){this._addLightQueues(n,h);for(var c,p=0,g=d.pipelineSceneData.shadows.size,u=s(this.shadowEnabledSpotLights);!(c=u()).done;){var m=c.value,f=d.addRenderPass(g.x,g.y,"default");f.name="SpotlightShadowPass",f.addRenderTarget("ShadowMap"+i,Ce.CLEAR,Ee.STORE,new Me(1,1,1,1)),f.addDepthStencil("ShadowDepth"+i,Ce.CLEAR,Ee.DISCARD),f.addQueue(He.NONE,"shadow-caster").addScene(n,Ve.OPAQUE|Ve.MASK|Ve.SHADOW_CASTER).useLightFrustum(m);var _=++p===this.shadowEnabledSpotLights.length?t:Ee.STORE;(h=d.addRenderPass(o,r,"default")).name="SpotlightWithShadowMap",h.setViewport(l),h.addRenderTarget(e,Ce.LOAD),h.addDepthStencil(a,Ce.LOAD,_),h.addTexture("ShadowMap"+i,"cc_spotShadowMap"),h.addQueue(He.BLEND,"forward-add").addScene(n,Ve.BLEND,m)}return h},a.isMultipleLightPassesNeeded=function(){return this.shadowEnabledSpotLights.length>0},e}(),Xe=function(){function e(){this._pipelineEvent=r.director.root.pipelineEvent,this._clearColor=new Me(0,0,0,1),this._clearColorTransparentBlack=new Me(0,0,0,0),this._reflectionProbeClearColor=new S(0,0,0),this._viewport=new De,this._configs=new Be,this._cameraConfigs=new ze,this._cocParams=new P(0,0,0,0),this._cocTexSize=new P(0,0,0,0),this._bloomParams=new P(0,0,0,0),this._bloomTexSize=new P(0,0,0,0),this._bloomWidths=[],this._bloomHeights=[],this._bloomTexNames=[],this._colorGradingTexSize=new R(0,0),this._fxaaParams=new P(0,0,0,0),this._fsrParams=new P(0,0,0,0),this._fsrTexSize=new P(0,0,0,0),this._copyAndTonemapMaterial=new g,this._initialized=!1,this.forwardLighting=new je}var a=e.prototype;return a.windowResize=function(e,a,t,i,o){Ne(e,this._configs),Ie(t,this._configs,this._cameraConfigs);var s=this._cameraConfigs.settings,r=a.renderWindowId,n=this._cameraConfigs.enableShadingScale?Math.max(Math.floor(i*this._cameraConfigs.shadingScale),1):i,l=this._cameraConfigs.enableShadingScale?Math.max(Math.floor(o*this._cameraConfigs.shadingScale),1):o;if(e.addRenderWindow(this._cameraConfigs.colorName,ye.RGBA8,i,o,a,this._cameraConfigs.depthStencilName),this._cameraConfigs.enableShadingScale?(e.addDepthStencil("ScaledSceneDepth"+r,ye.DEPTH_STENCIL,n,l),e.addRenderTarget("ScaledRadiance"+r,this._cameraConfigs.radianceFormat,n,l),e.addRenderTarget("ScaledLdrColor"+r,ye.RGBA8,n,l)):(e.addDepthStencil("SceneDepth"+r,ye.DEPTH_STENCIL,n,l),e.addRenderTarget("Radiance"+r,this._cameraConfigs.radianceFormat,n,l),e.addRenderTarget("LdrColor"+r,ye.RGBA8,n,l)),this._cameraConfigs.enableFSR&&e.addRenderTarget("FsrColor"+r,ye.RGBA8,i,o),this._cameraConfigs.enableMSAA&&(this._cameraConfigs.enableHDR?e.addTexture("MsaaRadiance"+r,xe.TEX2D,this._cameraConfigs.radianceFormat,n,l,1,1,1,s.msaa.sampleCount,Ue.COLOR_ATTACHMENT,We.MEMORYLESS):e.addTexture("MsaaRadiance"+r,xe.TEX2D,ye.RGBA8,n,l,1,1,1,s.msaa.sampleCount,Ue.COLOR_ATTACHMENT,We.MEMORYLESS),e.addTexture("MsaaDepthStencil"+r,xe.TEX2D,ye.DEPTH_STENCIL,n,l,1,1,1,s.msaa.sampleCount,Ue.DEPTH_STENCIL_ATTACHMENT,We.MEMORYLESS)),e.addRenderTarget("ShadowMap"+r,this._configs.shadowMapFormat,this._configs.shadowMapSize.x,this._configs.shadowMapSize.y),e.addDepthStencil("ShadowDepth"+r,ye.DEPTH_STENCIL,this._configs.shadowMapSize.x,this._configs.shadowMapSize.y),this._cameraConfigs.singleForwardRadiancePass)for(var d=this._configs.mobileMaxSpotLightShadowMaps,h=0;h!==d;++h)e.addRenderTarget("SpotShadowMap"+h,this._configs.shadowMapFormat,this._configs.shadowMapSize.x,this._configs.shadowMapSize.y),e.addDepthStencil("SpotShadowDepth"+h,ye.DEPTH_STENCIL,this._configs.shadowMapSize.x,this._configs.shadowMapSize.y);if(this._cameraConfigs.enableDOF){var c=Math.max(Math.floor(n/2),1),p=Math.max(Math.floor(l/2),1);e.addRenderTarget("DofRadiance"+r,this._cameraConfigs.radianceFormat,n,l),e.addRenderTarget("DofPrefilter"+r,this._cameraConfigs.radianceFormat,c,p),e.addRenderTarget("DofBokeh"+r,this._cameraConfigs.radianceFormat,c,p),e.addRenderTarget("DofFilter"+r,this._cameraConfigs.radianceFormat,c,p)}if(this._cameraConfigs.enableBloom)for(var g=n,u=l,m=0;m!==s.bloom.iterations+1;++m)g=Math.max(Math.floor(g/2),1),u=Math.max(Math.floor(u/2),1),e.addRenderTarget("BloomTex"+r+"_"+m,this._cameraConfigs.radianceFormat,g,u);this._cameraConfigs.enableColorGrading&&s.colorGrading.material&&s.colorGrading.colorGradingMap&&s.colorGrading.material.setProperty("colorGradingMap",s.colorGrading.colorGradingMap),this._cameraConfigs.enableFXAA&&this._cameraConfigs.enableShadingScale&&e.addRenderTarget("AaColor"+r,ye.RGBA8,n,l)},a.setup=function(e,a){if(!this._initMaterials(a))for(var t,i=s(e);!(t=i()).done;){var o=t.value;o.scene&&o.window&&(Ie(o,this._configs,this._cameraConfigs),this._pipelineEvent.emit(w.RENDER_CAMERA_BEGIN,o),this._cameraConfigs.useFullPipeline?this._buildForwardPipeline(a,o,o.scene):this._buildSimplePipeline(a,o),this._pipelineEvent.emit(w.RENDER_CAMERA_END,o))}},a._buildSimplePipeline=function(e,a){var t=Math.max(Math.floor(a.window.width),1),i=Math.max(Math.floor(a.window.height),1),o=this._cameraConfigs.colorName,s=this._cameraConfigs.depthStencilName,r=a.viewport;this._viewport.left=Math.round(r.x*t),this._viewport.top=Math.round(r.y*i),this._viewport.width=Math.max(Math.round(r.width*t),1),this._viewport.height=Math.max(Math.round(r.height*i),1);var n=a.clearColor;this._clearColor.x=n.x,this._clearColor.y=n.y,this._clearColor.z=n.z,this._clearColor.w=n.w;var l=e.addRenderPass(t,i,"default");Le(a)?l.addRenderTarget(o,Ce.CLEAR,Ee.STORE,this._clearColor):l.addRenderTarget(o,Ce.LOAD,Ee.STORE),a.clearFlag&we.DEPTH_STENCIL?l.addDepthStencil(s,Ce.CLEAR,Ee.DISCARD,a.clearDepth,a.clearStencil,a.clearFlag&we.DEPTH_STENCIL):l.addDepthStencil(s,Ce.LOAD,Ee.DISCARD),l.setViewport(this._viewport),l.addQueue(He.OPAQUE).addScene(a,Ve.OPAQUE);var d=Ve.BLEND|Ve.UI;this._cameraConfigs.enableProfiler&&(d|=Ve.PROFILER,l.showStatistics=!0),l.addQueue(He.BLEND).addScene(a,d)},a._buildForwardPipeline=function(e,a,t){var i,o=this._cameraConfigs.settings,s=Math.max(Math.floor(a.window.width),1),r=Math.max(Math.floor(a.window.height),1),n=this._cameraConfigs.enableShadingScale?Math.max(Math.floor(s*this._cameraConfigs.shadingScale),1):s,l=this._cameraConfigs.enableShadingScale?Math.max(Math.floor(r*this._cameraConfigs.shadingScale),1):r,d=a.window.renderWindowId,h=this._cameraConfigs.colorName,c=this._cameraConfigs.enableShadingScale?"ScaledSceneDepth"+d:"SceneDepth"+d,p=this._cameraConfigs.enableShadingScale?"ScaledRadiance"+d:"Radiance"+d,g=this._cameraConfigs.enableShadingScale?"ScaledLdrColor"+d:"LdrColor"+d,u=t.mainLight;if(this.forwardLighting.cullLights(t,a.frustum),this._cameraConfigs.enableMainLightShadowMap&&(M(!!u),this._addCascadedShadowMapPass(e,d,u,a)),this._cameraConfigs.singleForwardRadiancePass&&this.forwardLighting.addSpotlightShadowPasses(e,a,this._configs.mobileMaxSpotLightShadowMaps),this._tryAddReflectionProbePasses(e,d,u,a.scene),this._cameraConfigs.enablePostProcess){if(this._cameraConfigs.enableDOF){M(!!o.depthOfField.material);var m="DofRadiance"+d;this._addForwardRadiancePasses(e,d,a,n,l,u,m,c,!0,Ee.STORE),this._addDepthOfFieldPasses(e,o,o.depthOfField.material,d,a,n,l,m,c,p,g)}else this._addForwardRadiancePasses(e,d,a,n,l,u,p,c);if(this._cameraConfigs.enableBloom&&(M(!!o.bloom.material),this._addKawaseDualFilterBloomPasses(e,o,o.bloom.material,d,n,l,p)),this._cameraConfigs.enableFXAA){M(!!o.fxaa.material);var f=this._cameraConfigs.enableHDR||this._cameraConfigs.enableColorGrading,_=f?g:p;if(f&&this._addCopyAndTonemapPass(e,o,n,l,p,_),this._cameraConfigs.enableShadingScale){var b="AaColor"+d;this._addFxaaPass(e,o.fxaa.material,n,l,_,b),i=this._cameraConfigs.enableFSR&&o.fsr.material?this._addFsrPass(e,o,o.fsr.material,d,n,l,b,s,r,h):this._addCopyPass(e,s,r,b,h)}else i=this._addFxaaPass(e,o.fxaa.material,s,r,_,h)}else i=this._addTonemapResizeOrSuperResolutionPasses(e,o,d,n,l,p,g,s,r,h)}else this._cameraConfigs.enableHDR||this._cameraConfigs.enableShadingScale?(this._addForwardRadiancePasses(e,d,a,n,l,u,p,c),i=this._addTonemapResizeOrSuperResolutionPasses(e,o,d,n,l,p,g,s,r,h)):i=this._addForwardRadiancePasses(e,d,a,s,r,u,h,this._cameraConfigs.depthStencilName);this._addUIQueue(a,i)},a._addTonemapResizeOrSuperResolutionPasses=function(e,a,t,i,o,s,r,n,l,d){var h;return this._cameraConfigs.enableFSR&&a.fsr.material?(this._addCopyAndTonemapPass(e,a,i,o,s,r),h=this._addFsrPass(e,a,a.fsr.material,t,i,o,r,n,l,d)):h=this._addCopyAndTonemapPass(e,a,n,l,s,d),h},a._addCascadedShadowMapPass=function(e,a,t,i){var o=e.pipelineSceneData.shadows.size.x,s=e.pipelineSceneData.shadows.size.y;this._viewport.left=0,this._viewport.top=0,this._viewport.width=o,this._viewport.height=s;var r=e.addRenderPass(o,s,"default");r.name="CascadedShadowMap",r.addRenderTarget("ShadowMap"+a,Ce.CLEAR,Ee.STORE,new Me(1,1,1,1)),r.addDepthStencil("ShadowDepth"+a,Ce.CLEAR,Ee.DISCARD);for(var n=e.pipelineSceneData.csmSupported?t.csmLevel:1,l=0;l!==n;++l){Ge(t,o,s,l,this._viewport,this._configs.screenSpaceSignY);var d=r.addQueue(He.NONE,"shadow-caster");this._configs.isWebGPU||d.setViewport(this._viewport),d.addScene(i,Ve.OPAQUE|Ve.MASK|Ve.SHADOW_CASTER).useLightFrustum(t,l)}},a._addCopyPass=function(e,a,t,i,o){var s=e.addRenderPass(a,t,"cc-tone-mapping");return s.addRenderTarget(o,Ce.CLEAR,Ee.STORE,this._clearColorTransparentBlack),s.addTexture(i,"inputTexture"),s.setVec4("g_platform",this._configs.platform),s.addQueue(He.OPAQUE).addFullscreenQuad(this._copyAndTonemapMaterial,1),s},a._addCopyAndTonemapPass=function(e,a,t,i,o,s){var r;if(this._cameraConfigs.enableColorGrading&&a.colorGrading.material&&a.colorGrading.colorGradingMap){var n=a.colorGrading.colorGradingMap;this._colorGradingTexSize.x=n.width,this._colorGradingTexSize.y=n.height;var l=n.width===n.height;(r=l?e.addRenderPass(t,i,"cc-color-grading-8x8"):e.addRenderPass(t,i,"cc-color-grading-nx1")).addRenderTarget(s,Ce.CLEAR,Ee.STORE,this._clearColorTransparentBlack),r.addTexture(o,"sceneColorMap"),r.setVec4("g_platform",this._configs.platform),r.setVec2("lutTextureSize",this._colorGradingTexSize),r.setFloat("contribute",a.colorGrading.contribute),r.addQueue(He.OPAQUE).addFullscreenQuad(a.colorGrading.material,l?1:0)}else(r=e.addRenderPass(t,i,"cc-tone-mapping")).addRenderTarget(s,Ce.CLEAR,Ee.STORE,this._clearColorTransparentBlack),r.addTexture(o,"inputTexture"),r.setVec4("g_platform",this._configs.platform),a.toneMapping.material?r.addQueue(He.OPAQUE).addFullscreenQuad(a.toneMapping.material,0):r.addQueue(He.OPAQUE).addFullscreenQuad(this._copyAndTonemapMaterial,0);return r},a._buildForwardMainLightPass=function(e,a,t,i,o,s,r,n){void 0===n&&(n=null),e.setViewport(this._viewport);var l=this._cameraConfigs.enableMSAA?Ee.DISCARD:Ee.STORE;Le(t)?e.addRenderTarget(i,Ce.CLEAR,l,this._clearColor):e.addRenderTarget(i,Ce.LOAD,l),t.clearFlag&we.DEPTH_STENCIL?e.addDepthStencil(o,Ce.CLEAR,s,t.clearDepth,t.clearStencil,t.clearFlag&we.DEPTH_STENCIL):e.addDepthStencil(o,Ce.LOAD,s),this._cameraConfigs.enableMainLightShadowMap&&e.addTexture("ShadowMap"+a,"cc_shadowMap"),e.addQueue(He.NONE).addScene(t,Ve.OPAQUE|Ve.MASK,r||void 0,n||void 0)},a._addDepthOfFieldPasses=function(e,a,t,i,o,s,r,n,l,d,h){this._cocParams.x=a.depthOfField.focusDistance,this._cocParams.y=a.depthOfField.focusRange,this._cocParams.z=a.depthOfField.bokehRadius,this._cocParams.w=0,this._cocTexSize.x=1/s,this._cocTexSize.y=1/r,this._cocTexSize.z=s,this._cocTexSize.w=r;var c=Math.max(Math.floor(s/2),1),p=Math.max(Math.floor(r/2),1),g=h,u="DofPrefilter"+i,m="DofBokeh"+i,f="DofFilter"+i,_=e.addRenderPass(s,r,"cc-dof-coc");_.addRenderTarget(g,Ce.CLEAR,Ee.STORE,this._clearColorTransparentBlack),_.addTexture(l,"DepthTex"),_.setVec4("g_platform",this._configs.platform),_.setMat4("proj",o.matProj),_.setVec4("cocParams",this._cocParams),_.addQueue(He.OPAQUE).addCameraQuad(o,t,0);var b=e.addRenderPass(c,p,"cc-dof-prefilter");b.addRenderTarget(u,Ce.CLEAR,Ee.STORE,this._clearColorTransparentBlack),b.addTexture(n,"colorTex"),b.addTexture(g,"cocTex"),b.setVec4("g_platform",this._configs.platform),b.setVec4("mainTexTexelSize",this._cocTexSize),b.addQueue(He.OPAQUE).addFullscreenQuad(t,1);var S=e.addRenderPass(c,p,"cc-dof-bokeh");S.addRenderTarget(m,Ce.CLEAR,Ee.STORE,this._clearColorTransparentBlack),S.addTexture(u,"prefilterTex"),S.setVec4("g_platform",this._configs.platform),S.setVec4("mainTexTexelSize",this._cocTexSize),S.setVec4("cocParams",this._cocParams),S.addQueue(He.OPAQUE).addFullscreenQuad(t,2);var P=e.addRenderPass(c,p,"cc-dof-filter");P.addRenderTarget(f,Ce.CLEAR,Ee.STORE,this._clearColorTransparentBlack),P.addTexture(m,"bokehTex"),P.setVec4("g_platform",this._configs.platform),P.setVec4("mainTexTexelSize",this._cocTexSize),P.addQueue(He.OPAQUE).addFullscreenQuad(t,3);var R=e.addRenderPass(s,r,"cc-dof-combine");R.addRenderTarget(d,Ce.CLEAR,Ee.STORE,this._clearColorTransparentBlack),R.addTexture(n,"colorTex"),R.addTexture(g,"cocTex"),R.addTexture(f,"filterTex"),R.setVec4("g_platform",this._configs.platform),R.setVec4("cocParams",this._cocParams),R.addQueue(He.OPAQUE).addFullscreenQuad(t,4)},a._addKawaseDualFilterBloomPasses=function(e,a,t,i,o,s,r){var n=a.bloom.iterations,l=n+1;this._bloomWidths.length=l,this._bloomHeights.length=l,this._bloomWidths[0]=Math.max(Math.floor(o/2),1),this._bloomHeights[0]=Math.max(Math.floor(s/2),1);for(var d=1;d!==l;++d)this._bloomWidths[d]=Math.max(Math.floor(this._bloomWidths[d-1]/2),1),this._bloomHeights[d]=Math.max(Math.floor(this._bloomHeights[d-1]/2),1);this._bloomTexNames.length=l;for(var h=0;h!==l;++h)this._bloomTexNames[h]="BloomTex"+i+"_"+h;this._bloomParams.x=this._configs.useFloatOutput?1:0,this._bloomParams.x=0,this._bloomParams.z=a.bloom.threshold,this._bloomParams.w=a.bloom.enableAlphaMask?1:0;var c=e.addRenderPass(this._bloomWidths[0],this._bloomHeights[0],"cc-bloom-prefilter");c.addRenderTarget(this._bloomTexNames[0],Ce.CLEAR,Ee.STORE,this._clearColorTransparentBlack),c.addTexture(r,"inputTexture"),c.setVec4("g_platform",this._configs.platform),c.setVec4("bloomParams",this._bloomParams),c.addQueue(He.OPAQUE).addFullscreenQuad(t,0);for(var p=1;p!==l;++p){var g=e.addRenderPass(this._bloomWidths[p],this._bloomHeights[p],"cc-bloom-downsample");g.addRenderTarget(this._bloomTexNames[p],Ce.CLEAR,Ee.STORE,this._clearColorTransparentBlack),g.addTexture(this._bloomTexNames[p-1],"bloomTexture"),this._bloomTexSize.x=this._bloomWidths[p-1],this._bloomTexSize.y=this._bloomHeights[p-1],g.setVec4("g_platform",this._configs.platform),g.setVec4("bloomTexSize",this._bloomTexSize),g.addQueue(He.OPAQUE).addFullscreenQuad(t,1)}for(var u=n;u-- >0;){var m=e.addRenderPass(this._bloomWidths[u],this._bloomHeights[u],"cc-bloom-upsample");m.addRenderTarget(this._bloomTexNames[u],Ce.CLEAR,Ee.STORE,this._clearColorTransparentBlack),m.addTexture(this._bloomTexNames[u+1],"bloomTexture"),this._bloomTexSize.x=this._bloomWidths[u+1],this._bloomTexSize.y=this._bloomHeights[u+1],m.setVec4("g_platform",this._configs.platform),m.setVec4("bloomTexSize",this._bloomTexSize),m.addQueue(He.OPAQUE).addFullscreenQuad(t,2)}var f=e.addRenderPass(o,s,"cc-bloom-combine");f.addRenderTarget(r,Ce.LOAD,Ee.STORE),f.addTexture(this._bloomTexNames[0],"bloomTexture"),f.setVec4("g_platform",this._configs.platform),f.setVec4("bloomParams",this._bloomParams),f.addQueue(He.BLEND).addFullscreenQuad(t,3)},a._addFsrPass=function(e,a,t,i,o,s,r,n,l,d){this._fsrTexSize.x=o,this._fsrTexSize.y=s,this._fsrTexSize.z=n,this._fsrTexSize.w=l,this._fsrParams.x=y(1-a.fsr.sharpness,.02,.98);var h="FsrColor"+i,c=e.addRenderPass(n,l,"cc-fsr-easu");c.addRenderTarget(h,Ce.CLEAR,Ee.STORE,this._clearColorTransparentBlack),c.addTexture(r,"outputResultMap"),c.setVec4("g_platform",this._configs.platform),c.setVec4("fsrTexSize",this._fsrTexSize),c.addQueue(He.OPAQUE).addFullscreenQuad(t,0);var p=e.addRenderPass(n,l,"cc-fsr-rcas");return p.addRenderTarget(d,Ce.CLEAR,Ee.STORE,this._clearColorTransparentBlack),p.addTexture(h,"outputResultMap"),p.setVec4("g_platform",this._configs.platform),p.setVec4("fsrTexSize",this._fsrTexSize),p.setVec4("fsrParams",this._fsrParams),p.addQueue(He.OPAQUE).addFullscreenQuad(t,1),p},a._addFxaaPass=function(e,a,t,i,o,s){this._fxaaParams.x=t,this._fxaaParams.y=i,this._fxaaParams.z=1/t,this._fxaaParams.w=1/i;var r=e.addRenderPass(t,i,"cc-fxaa");return r.addRenderTarget(s,Ce.CLEAR,Ee.STORE,this._clearColorTransparentBlack),r.addTexture(o,"sceneColorMap"),r.setVec4("g_platform",this._configs.platform),r.setVec4("texSize",this._fxaaParams),r.addQueue(He.OPAQUE).addFullscreenQuad(a,0),r},a._addUIQueue=function(e,a){var t=Ve.UI;this._cameraConfigs.enableProfiler&&(t|=Ve.PROFILER,a.showStatistics=!0),a.addQueue(He.BLEND,"default","default").addScene(e,t)},a._addForwardRadiancePasses=function(e,a,t,i,o,s,r,n,l,d){void 0===l&&(l=!1),void 0===d&&(d=Ee.DISCARD);var h=t.clearColor;this._clearColor.x=h.x,this._clearColor.y=h.y,this._clearColor.z=h.z,this._clearColor.w=h.w;var c=t.viewport;this._viewport.left=Math.round(c.x*i),this._viewport.top=Math.round(c.y*o),this._viewport.width=Math.max(Math.round(c.width*i),1),this._viewport.height=Math.max(Math.round(c.height*o),1);var p=!l&&this._cameraConfigs.enableMSAA;M(!p||this._cameraConfigs.singleForwardRadiancePass);var g=this._cameraConfigs.singleForwardRadiancePass?this._addForwardSingleRadiancePass(e,a,t,p,i,o,s,r,n,d):this._addForwardMultipleRadiancePasses(e,a,t,i,o,s,r,n,d);this._cameraConfigs.enableMainLightPlanarShadowMap&&this.addPlanarShadowQueue(t,s,g);var u=Ve.BLEND|(t.geometryRenderer?Ve.GEOMETRY:Ve.NONE);return g.addQueue(He.BLEND).addScene(t,u,s||void 0),g},a._addForwardSingleRadiancePass=function(e,a,t,i,o,s,r,n,l,d){var h;if(M(this._cameraConfigs.singleForwardRadiancePass),i){var c="MsaaRadiance"+a,p="MsaaDepthStencil"+a,g=this._cameraConfigs.settings.msaa.sampleCount,u=e.addMultisampleRenderPass(o,s,g,0,"default");u.name="MsaaForwardPass",this._buildForwardMainLightPass(u,a,t,c,p,Ee.DISCARD,r),u.resolveRenderTarget(c,n),h=u}else(h=e.addRenderPass(o,s,"default")).name="ForwardPass",this._buildForwardMainLightPass(h,a,t,n,l,d,r);return M(void 0!==h),this.forwardLighting.addLightQueues(h,t,this._configs.mobileMaxSpotLightShadowMaps),h},a.addPlanarShadowQueue=function(e,a,t){t.addQueue(He.BLEND,"planar-shadow").addScene(e,Ve.SHADOW_CASTER|Ve.PLANAR_SHADOW|Ve.BLEND,a||void 0)},a._addForwardMultipleRadiancePasses=function(e,a,t,i,o,s,r,n,l){M(!this._cameraConfigs.singleForwardRadiancePass);var d=e.addRenderPass(i,o,"default");d.name="ForwardPass";var h=this.forwardLighting.isMultipleLightPassesNeeded()?Ee.STORE:l;return this._buildForwardMainLightPass(d,a,t,r,n,h,s),d=this.forwardLighting.addLightPasses(r,n,l,a,i,o,t,this._viewport,e,d)},a._buildReflectionProbePass=function(e,a,t,i,o,s,r){void 0===r&&(r=null);var n=this._cameraConfigs.enableMSAA?Ee.DISCARD:Ee.STORE;if(Le(t)){this._reflectionProbeClearColor.x=t.clearColor.x,this._reflectionProbeClearColor.y=t.clearColor.y,this._reflectionProbeClearColor.z=t.clearColor.z;var l=m.packRGBE(this._reflectionProbeClearColor);this._clearColor.x=l.x,this._clearColor.y=l.y,this._clearColor.z=l.z,this._clearColor.w=l.w,e.addRenderTarget(i,Ce.CLEAR,n,this._clearColor)}else e.addRenderTarget(i,Ce.LOAD,n);t.clearFlag&we.DEPTH_STENCIL?e.addDepthStencil(o,Ce.CLEAR,Ee.DISCARD,t.clearDepth,t.clearStencil,t.clearFlag&we.DEPTH_STENCIL):e.addDepthStencil(o,Ce.LOAD,Ee.DISCARD),this._cameraConfigs.enableMainLightShadowMap&&e.addTexture("ShadowMap"+a,"cc_shadowMap"),e.addQueue(He.NONE,"reflect-map").addScene(t,Ve.OPAQUE|Ve.MASK|Ve.REFLECTION_PROBE,s||void 0,r||void 0)},a._tryAddReflectionProbePasses=function(e,a,t,i){var o=r.internal.reflectionProbeManager;if(o)for(var l,d=o.getProbes(),h=0,c=s(d);!(l=c()).done;){var p=l.value;if(p.needRender){var g=p.renderArea(),u=Math.max(Math.floor(g.x),1),m=Math.max(Math.floor(g.y),1);if(p.probeType===b.scene.ProbeType.PLANAR){if(!this._cameraConfigs.enablePlanarReflectionProbe)continue;var f=p.realtimePlanarTexture.window,_="PlanarProbeRT"+h,S="PlanarProbeDS"+h;e.addRenderWindow(_,this._cameraConfigs.radianceFormat,u,m,f),e.addDepthStencil(S,n.Format.DEPTH_STENCIL,u,m,We.MEMORYLESS);var P=e.addRenderPass(u,m,"default");P.name="PlanarReflectionProbe"+h,this._buildReflectionProbePass(P,a,p.camera,_,S,t,i)}if(4===++h)break}}},a._initMaterials=function(e){return this._initialized?0:(Ne(e,this._configs),this._copyAndTonemapMaterial._uuid="builtin-pipeline-tone-mapping-material",this._copyAndTonemapMaterial.initialize({effectName:"pipeline/post-process/tone-mapping"}),this._copyAndTonemapMaterial.effectAsset&&(this._initialized=!0),this._initialized?0:1)},e}();m.setCustomPipeline("Builtin",new Xe)}r._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/internal', 'chunks:///internal.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});